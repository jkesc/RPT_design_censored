function curves2stp(X,Y,Z,filename,closeCurve)
if nargin==4
    closeCurve=1;
end
%Converts a number of curves to a stp. file
fid=fopen([filename,'.stp'],'w');
%I don't dare changing any of this, so I guess this file now belongs to
%simis now...?

fprintf(fid,['ISO-10303-21;\n'...
'HEADER;\n'...
'FILE_DESCRIPTION((''''), '' '');\n'...
'FILE_NAME(''PRT0001'',''2020-09-16T12:29:47'',(''ashes''),(''''),''ASHES BY SIMIS AS'',''ASHES BY SIMIS AS'','''');\n'...
'FILE_SCHEMA((''AUTOMOTIVE_DESIGN { 1 0 10303 214 1 1 1 1 }'' ));\n'...
'ENDSEC;\n'...
'DATA;\n'...
'#1 = UNCERTAINTY_MEASURE_WITH_UNIT( LENGTH_MEASURE( 1.00000000000000E-06 ), #2, '''', '''' );\n'...
'#2 =  ( CONVERSION_BASED_UNIT( ''METRE'', #6 )LENGTH_UNIT(  )NAMED_UNIT( #7 ) );\n'...
'#3 = (NAMED_UNIT(#8)PLANE_ANGLE_UNIT()SI_UNIT($, .RADIAN.));\n'...
'#4 = (NAMED_UNIT(#8)SI_UNIT($, .STERADIAN.)SOLID_ANGLE_UNIT());\n'...
'#5 = AXIS2_PLACEMENT_3D( '''', #9, #10, #11 );\n'...
'#6 = LENGTH_MEASURE_WITH_UNIT( LENGTH_MEASURE( 1.00000000000000 ), #12 );\n'...
'#7 = DIMENSIONAL_EXPONENTS( 1.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000 );\n'...
'#8 = DIMENSIONAL_EXPONENTS(0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000, 0.00000000000000);\n'...
'#9 = CARTESIAN_POINT( '''', ( 0.00000000000000, 0.00000000000000, 0.00000000000000 ) );\n'...
'#10 = DIRECTION( '''', ( 0.00000000000000, 0.00000000000000, 1.00000000000000 ) );\n'...
'#11 = DIRECTION( '''', ( 1.00000000000000, 0.00000000000000, 0.00000000000000 ) );\n'...
'#12 = ( LENGTH_UNIT(  )NAMED_UNIT( #7 )SI_UNIT( $, .METRE. ) );\n'...
'#13 = ( CONVERSION_BASED_UNIT(''DEGREE'',#14)NAMED_UNIT(#8)PLANE_ANGLE_UNIT() );\n'...
'#14 = PLANE_ANGLE_MEASURE_WITH_UNIT(PLANE_ANGLE_MEASURE(0.0174532925),#3);\n'...
'#15 = (\n'...
'GEOMETRIC_REPRESENTATION_CONTEXT(3)\n'...
'GLOBAL_UNCERTAINTY_ASSIGNED_CONTEXT((#1))\n'...
'GLOBAL_UNIT_ASSIGNED_CONTEXT((#12,#13,#4))\n'...
'REPRESENTATION_CONTEXT('''',''TOP_LEVEL_ASSEMBLY_PART'')\n'...
');']);

try
Nr=16;
Nrlist=[];
Curvelist=[];
for j=1:1:size(X,2)
    for i=1:1:size(X,1)
        fprintf(fid,'#%i = CARTESIAN_POINT( '''', (%f, %f, %f) );\n',Nr,X(i,j),Y(i,j),Z(i,j));
        Nrlist(size(Nrlist,2)+1)=Nr;
        Nr=Nr+1;
    end
    fprintf(fid,'#%i = POLYLINE( '''', (#%i',Nr,Nrlist(1));
    fprintf(fid,',#%i',Nrlist(2:end));
    if closeCurve==1
    fprintf(fid,',#%i));\n',Nrlist(1));
    else
        fprintf(fid,'));\n');
    end
    Curvelist(size(Curvelist,2)+1)=Nr;
    Nr=Nr+1;
    Nrlist=[];
end
fprintf(fid,'#%i = GEOMETRIC_CURVE_SET( '''', (',Nr);
fprintf(fid,'#%i,',Curvelist);
fprintf(fid,') );\n');
Nr=Nr+1;
fprintf(fid,'#%i = GEOMETRICALLY_BOUNDED_WIREFRAME_SHAPE_REPRESENTATION('''', (#%i), #15);\n',Nr,Nr-1);
fprintf(fid,['ENDSEC;\n'...
'END-ISO-10303-21;\n']);
catch
    fprintf('there was an error somewhere')
end
fclose(fid);
end

